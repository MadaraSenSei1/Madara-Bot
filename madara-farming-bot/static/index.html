<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Travian Farming Bot</title>
    <script>
        async function login() {
            const form = new FormData(document.getElementById("loginForm"));
            const response = await fetch("/login", {
                method: "POST",
                body: form
            });
            const result = await response.json();
            if (result.message) {
                sessionStorage.setItem("username", form.get("username"));
                document.getElementById("loginSection").style.display = "none";
                document.getElementById("dashboard").style.display = "block";
                loadFarmLists();
            } else {
                alert("Login failed!");
            }
        }

        async function loadFarmLists() {
            const username = sessionStorage.getItem("username");
            const response = await fetch(`/farmlist?username=${username}`);
            const result = await response.json();
            const container = document.getElementById("farmLists");
            container.innerHTML = "";

            if (result.farms && result.farms.length > 0) {
                result.farms.forEach(farm => {
                    const item = document.createElement("li");
                    item.textContent = farm;
                    container.appendChild(item);
                });
            } else {
                container.innerHTML = "<li>‚ö†Ô∏è Failed to load farm lists.</li>";
            }
        }

        async function startBot() {
            const username = sessionStorage.getItem("username");
            const form = new FormData();
            form.append("username", username);
            form.append("interval_min", document.getElementById("minInterval").value);
            form.append("interval_max", document.getElementById("maxInterval").value);
            form.append("random_delay", document.getElementById("randomDelay").checked);

            await fetch("/start-bot", {
                method: "POST",
                body: form
            });

            alert("Bot started!");
        }
    </script>
</head>
<body>
    <div id="loginSection">
        <h2>Travian Farming Bot ‚Äì Login</h2>
        <form id="loginForm">
            <input name="username" placeholder="Username" required><br>
            <input name="password" type="password" placeholder="Password" required><br>
            <input name="server_url" placeholder="Server URL (e.g. https://ts9.x1.europe.travian.com)" required><br>
            <input name="proxy_ip" placeholder="Proxy IP"><br>
            <input name="proxy_port" placeholder="Proxy Port"><br>
            <input name="proxy_user" placeholder="Proxy Username"><br>
            <input name="proxy_pass" placeholder="Proxy Password"><br>
        </form>
        <button onclick="login()">Login</button>
    </div>

    <div id="dashboard" style="display:none;">
        <h2>Farm Bot Dashboard</h2>
        <p>Logged in as: <span id="usernameLabel"><script>document.write(sessionStorage.getItem("username"))</script></span></p>
        <label>Minimum Interval (minutes):</label><br>
        <input id="minInterval" type="number" value="10"><br>
        <label>Maximum Interval (minutes):</label><br>
        <input id="maxInterval" type="number" value="15"><br>
        <label><input id="randomDelay" type="checkbox"> + Random Delay: 0‚Äì30 seconds</label><br>
        <button onclick="startBot()">‚ñ∂ Start Bot</button>
        <button onclick="loadFarmLists()">üîÑ Refresh Farm Lists</button>
        <h4>Available Farm Lists</h4>
        <ul id="farmLists"></ul>
    </div>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Travian Farming Bot</title>
    <script>
        async function login() {
            const form = new FormData(document.getElementById("loginForm"));
            const response = await fetch("/login", {
                method: "POST",
                body: form
            });
            const result = await response.json();
            if (result.message) {
                sessionStorage.setItem("username", form.get("username"));
                document.getElementById("loginSection").style.display = "none";
                document.getElementById("dashboard").style.display = "block";
                loadFarmLists();
            } else {
                alert("Login failed!");
            }
        }

        async function loadFarmLists() {
            const username = sessionStorage.getItem("username");
            const response = await fetch(`/farmlist?username=${username}`);
            const result = await response.json();
            const container = document.getElementById("farmLists");
            container.innerHTML = "";

            if (result.farms && result.farms.length > 0) {
                result.farms.forEach(farm => {
                    const item = document.createElement("li");
                    item.textContent = farm;
                    container.appendChild(item);
                });
            } else {
                container.innerHTML = "<li>‚ö†Ô∏è Failed to load farm lists.</li>";
            }
        }

        async function startBot() {
            const username = sessionStorage.getItem("username");
            const form = new FormData();
            form.append("username", username);
            form.append("interval_min", document.getElementById("minInterval").value);
            form.append("interval_max", document.getElementById("maxInterval").value);
            form.append("random_delay", document.getElementById("randomDelay").checked);

            await fetch("/start-bot", {
                method: "POST",
                body: form
            });

            alert("Bot started!");
        }
    </script>
</head>
<body>
    <div id="loginSection">
        <h2>Travian Farming Bot ‚Äì Login</h2>
        <form id="loginForm">
            <input name="username" placeholder="Username" required><br>
            <input name="password" type="password" placeholder="Password" required><br>
            <input name="server_url" placeholder="Server URL (e.g. https://ts9.x1.europe.travian.com)" required><br>
            <input name="proxy_ip" placeholder="Proxy IP"><br>
            <input name="proxy_port" placeholder="Proxy Port"><br>
            <input name="proxy_user" placeholder="Proxy Username"><br>
            <input name="proxy_pass" placeholder="Proxy Password"><br>
        </form>
        <button onclick="login()">Login</button>
    </div>

    <div id="dashboard" style="display:none;">
        <h2>Farm Bot Dashboard</h2>
        <p>Logged in as: <span id="usernameLabel"><script>document.write(sessionStorage.getItem("username"))</script></span></p>
        <label>Minimum Interval (minutes):</label><br>
        <input id="minInterval" type="number" value="10"><br>
        <label>Maximum Interval (minutes):</label><br>
        <input id="maxInterval" type="number" value="15"><br>
        <label><input id="randomDelay" type="checkbox"> + Random Delay: 0‚Äì30 seconds</label><br>
        <button onclick="startBot()">‚ñ∂ Start Bot</button>
        <button onclick="loadFarmLists()">üîÑ Refresh Farm Lists</button>
        <h4>Available Farm Lists</h4>
        <ul id="farmLists"></ul>
    </div>
</body>
</html>
